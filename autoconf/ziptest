#!/bin/sh
#*=====================================================================*/
#*    serrano/prgm/project/bigloo/autoconf/ziptest                     */
#*    -------------------------------------------------------------    */
#*    Author      :  Manuel Serrano                                    */
#*    Creation    :  Wed Aug  9 13:27:23 1995                          */
#*    Last change :  Thu Jan  3 10:16:51 2002 (serrano)                */
#*    -------------------------------------------------------------    */
#*    Give the ptr size on the current architecture                    */
#*=====================================================================*/

#*---------------------------------------------------------------------*/
#*    flags                                                            */
#*---------------------------------------------------------------------*/
zip=
zflags=
tmp=/tmp
user=bigloo

#*---------------------------------------------------------------------*/
#*    We parse the arguments                                           */
#*---------------------------------------------------------------------*/
while : ; do
  case $1 in
    "")
      break;;

    --user=*)
      user="`echo $1 | sed 's/^[-a-z]*=//'`";;

    --zflags=*|-zflags=*)
      zflags="`echo $1 | sed 's/^[-a-z]*=//'`";;

    --zip=*|-zip=*)
      zip="`echo $1 | sed 's/^[-a-z]*=//'`";;

    --tmp=*|-tmp=*)
      tmp="`echo $1 | sed 's/^[-a-z]*=//'`";;

    -*)
      echo "Unknown option \"$1\", ignored" >&2;;
  esac
  shift
done

file=tmpzip$user

#*---------------------------------------------------------------------*/
#*    compile                                                          */
#*---------------------------------------------------------------------*/
dozip="$zip $zflags $file.zip $file.txt 2> /dev/null > /dev/null"

#*---------------------------------------------------------------------*/
#*    The test txt file                                                */
#*---------------------------------------------------------------------*/
if( test -f $file.txt ); then
   rm -f $file.txt || exit $?
fi

#*---------------------------------------------------------------------*/
#*    Test                                                             */
#*---------------------------------------------------------------------*/
cat > $file.txt <<EOF
main( argc, argv )
int   argc;
char *argv[];
{
   exit( 0 );
}
EOF

#*---------------------------------------------------------------------*/
#*    zip                                                              */
#*---------------------------------------------------------------------*/
eval "$BUILDSH $dozip" 2> /dev/null > /dev/null

res=$?

rm $file.*

exit $res
