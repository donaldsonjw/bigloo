<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD>
<!-- SPOD - Scheme Plain Old Documentation, version 1.8 -->
<!-- (c) 2004 Hans Oesterholt <hdnews@gawab.com> -->
<!-- 
 -->
<!-- License: LGPL, see www.gnu.org for details. -->
<!-- 
 -->
<META http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<STYLE TYPE="text/css">
<!--
/* 
   $Id: README.aix.html 1.1 Sat, 02 Apr 2005 07:03:49 +0200 serrano $

   Why invent the weel again?

   This style sheet originates from cpan.org and has been extended
   with various indent levels and has modified colours.
*/

BODY {
  background: white;
  color: black;
  font-family: arial,sans-serif;
  margin: 0;
  padding: 1ex;
}

TABLE {
  border-collapse: collapse;
  border-spacing: 0;
  border-width: 0;
  color: inherit;
}

IMG { border: 0; }
FORM { margin: 0; }
input { margin: 2px; }

A.fred {
  text-decoration: none;
}

A:link, A:visited {
  background: transparent;
  color: #008855;
}

A[href="#POD_ERRORS"] {
  background: transparent;
  color: #FF0000;
}

TD {
  margin: 0;
  padding: 0;
}

DIV {
  border-width: 0;
}

DT {
  margin-top: 1em;
}

.credits TD {
  padding: 0.5ex 2ex;
}

.huge {
  font-size: 32pt;
}

.s {
  background: #dddddd;
  color: inherit;
}

.s TD, .r TD {
  padding: 0.2ex 1ex;
  vertical-align: baseline;
}

TH {
  background: #bbbbbb;
  color: inherit;
  padding: 0.4ex 1ex;
  text-align: left;
}

TH A:link, TH A:visited {
  background: transparent;
  color: black;
}

.box {
  border: 1px solid #006699;
  margin: 1ex 0;
  padding: 0;
}

.distfiles TD {
  padding: 0 2ex 0 0;
  vertical-align: baseline;
}

.manifest TD {
  padding: 0 1ex;
  vertical-align: top;
}

.l1 {
  font-weight: bold;
}

.l2 {
  font-weight: normal;
}

.t1, .t2, .t3, .t4  {
  background: #006699;
  color: white;
}
.t4 {
  padding: 0.2ex 0.4ex;
}
.t1, .t2, .t3  {
  padding: 0.5ex 1ex;
}

/* IE does not support  .box>.t1  Grrr */
.box .t1, .box .t2, .box .t3 {
  margin: 0;
}

.t1 {
  font-size: 1.4em;
  font-weight: bold;
  text-align: center;
}

.t2 {
  font-size: 1.0em;
  font-weight: bold;
  text-align: left;
}

.t3 {
  font-size: 1.0em;
  font-weight: normal;
  text-align: left;
}

/* width: 100%; border: 0.1px solid #FFFFFF; */ /* NN4 hack */

.datecell {
  text-align: center;
  width: 17em;
}

.cell {
  padding: 0.2ex 1ex;
  text-align: left;
}

.label {
  background: #aaaaaa;
  color: black;
  font-weight: bold;
  padding: 0.2ex 1ex;
  text-align: right;
  white-space: nowrap;
  vertical-align: baseline;
}

.categories {
  border-bottom: 3px double #006699;
  margin-bottom: 1ex;
  padding-bottom: 1ex;
}

.categories TABLE {
  margin: auto;
}

.categories TD {
  padding: 0.5ex 1ex;
  vertical-align: baseline;
}

.path A {
  background: transparent;
  color: #006699;
  font-weight: bold;
}

.pages {
  background: #dddddd;
  color: #006699;
  padding: 0.2ex 0.4ex;
}

.path {
  background: #dddddd;
  border-bottom: 1px solid #006699;
  color: #006699;
 /*  font-size: 1.4em;*/
  margin: 1ex 0;
  padding: 0.5ex 1ex;
}

.menubar TD {
  background: #006699;
  color: white;
}

.menubar {
  background: #006699;
  color: white;
  margin: 1ex 0;
  padding: 1px;
}

.menubar .links     {
  background: transparent;
  color: white;
  padding: 0.2ex;
  text-align: left;
}

.menubar .searchbar {
  background: black;
  color: black;
  margin: 0px;
  padding: 2px;
  text-align: right;
}

A.m:link, A.m:visited {
  background: #006699;
  color: white;
  font: bold 10pt Arial,Helvetica,sans-serif;
text-decoration: none;
}

A.o:link, A.o:visited {
  background: #006699;
  color: #ccffcc;
  font: bold 10pt Arial,Helvetica,sans-serif;
text-decoration: none;
}

A.o:hover {
  background: transparent;
  color: #ff6600;
  text-decoration: underline;
}

A.m:hover {
  background: transparent;
  color: #ff6600;
  text-decoration: underline;
}

table.dlsip     {
  background: #dddddd;
  border: 0.4ex solid #dddddd;
}

.spod PRE     {
  background: #eeeeee;
  border: 1px solid #888888;
  color: black;
  padding: 1em;
  white-space: pre;
}

.spod H1      {
  background: transparent;
  color: #008866;
  font-size: large;
}

.spod H2      {
  background: transparent;
  color: #008866;
  font-size: medium;
}

.spod H3	{
  background: transparent;
  color: #000000;
  font-size: normal;
}


.spod .itemindent {
	margin-left: -1em;
}

.spod .indent1 {
	margin-left: 1em;
}

.spod .indent2 {
	margin-left: 2em;
}

.spod .indent3 {
	margin-left: 3em;
}

.spod .indent4 {
	margin-left: 4em;
}

.spod .indent5 {
	margin-left: 5em;
}

.spod .indent6 {
	margin-left: 6em;
}

.spod .indent7 {
	margin-left: 7em;
}


.spod IMG     {
  vertical-align: top;
}

.spod .toc A  {
  text-decoration: none;
}

.spod .toc .indent1 {
	margin-left: 1em;
}

.spod .toc .indent2 {
	margin-left: 2em;
}

.spod .toc .indent3 {
	margin-left: 3em;
}

.spod .toc .indent4 {
	margin-left: 4em;
}

.spod .toc .indent5 {
	margin-left: 5em;
}

.spod .toc .indent6 {
	margin-left: 6em;
}

.spod .toc .indent7 {
	margin-left: 7em;
}

.spod .toc LI {
  line-height: 1.2em;
  list-style-type: none;
}

.faq DT {
  font-size: 1.4em;
  font-weight: bold;
}

.chmenu {
  background: black;
  color: red;
  font: bold 1.1em Arial,Helvetica,sans-serif;
  margin: 1ex auto;
  padding: 0.5ex;
}

.chmenu TD {
  padding: 0.2ex 1ex;
}

.chmenu A:link, .chmenu A:visited  {
  background: transparent;
  color: white;
  text-decoration: none;
}

.chmenu A:hover {
  background: transparent;
  color: #ff6600;
  text-decoration: underline;
}

.column {
  padding: 0.5ex 1ex;
  vertical-align: top;
}

.datebar {
  margin: auto;
  width: 14em;
}

.date {
  background: transparent;
  color: #008000;
}

.tiny {
	font-size: 0.7em;
}

-->
</STYLE>
<TITLE>README.aix - Instaling bigloo on an AIX system.</TITLE>
</HEAD>
<BODY>
<DIV class=spod>
<DIV class=toc><A NAME="_top"><H1>Contents</H1></A><A HREF="#NAME"><DIV class=indent1>
NAME</DIV>
</A><A HREF="#Some_data"><DIV class=indent1>
Some data</DIV>
</A><A HREF="#Introduction"><DIV class=indent1>
Introduction</DIV>
</A><A HREF="#Things_of_interest"><DIV class=indent2>
Things of interest</DIV>
</A><A HREF="#Configuring_the_GC"><DIV class=indent1>
Configuring the GC</DIV>
</A><A HREF="#Compiling_Hans_Boehm_s_GC"><DIV class=indent2>
Compiling Hans Boehm's GC</DIV>
</A><A HREF="#Configuring_C_bigloo__with_the_external_GC"><DIV class=indent2>
Configuring <CODE>bigloo</CODE> with the external GC</DIV>
</A><A HREF="#Extra_scripts_to_get_C_bigloo__configured_compiled"><DIV class=indent1>
Extra scripts to get <CODE>bigloo</CODE> configured/compiled</DIV>
</A><A HREF="#A_wrapper_for_AIX_C_as"><DIV class=indent2>
A wrapper for AIX <CODE>as</CODE></DIV>
</A><A HREF="#A_wrapper_to_link_shared_libraries_on_AIX"><DIV class=indent2>
A wrapper to link shared libraries on AIX</DIV>
</A><A HREF="#configuring_C_bigloo"><DIV class=indent1>
configuring <CODE>bigloo</CODE></DIV>
</A><A HREF="#Building_C_bigloo"><DIV class=indent1>
Building <CODE>bigloo</CODE></DIV>
</A><A HREF="#Making_it"><DIV class=indent2>
Making it</DIV>
</A><A HREF="#Testresults"><DIV class=indent2>
Testresults</DIV>
</A><A HREF="#Authors"><DIV class=indent1>
Authors</DIV>
</A></DIV><DIV class=toc><A NAME="NAME"></A><A HREF="#top"><H1>NAME</H1></A></DIV>
<P>README.aix - Instaling bigloo on an AIX system.
</P>
<DIV class=toc><A NAME="Some_data"></A><A HREF="#top"><H1>Some data</H1></A></DIV>
<PRE> Initial date of writing   : January 14, 2004, by Manuel Serrano
 Last date of modification : January 14, 2004, by Hans Oesterholt-Dijkema
</PRE>
<P>This readme is in Plain Old Documentation (POD) format.
It can be processed by Perl's <CODE>pod2html</CODE>, or by 
Hans Oesterholt's <CODE>spod2html</CODE> (which at the moment of writing
has not yet entered the public domain). To convert the document using
<CODE>spod2html</CODE> use '<CODE>spod2html --comment README.aix</CODE>'. It will generate
<CODE>README.aix.html</CODE>.
</P>
<DIV class=toc><A NAME="Introduction"></A><A HREF="#top"><H1>Introduction</H1></A></DIV>
<P>In this readme I will supply a recipe to compile <CODE>bigloo</CODE> on AIX 4.3.3,
using the native cc compiler. 
</P>
<DIV class=toc><A NAME="Things_of_interest"></A><A HREF="#top"><H2>Things of interest</H2></A></DIV>
<DIV class=indent1>
<UL>
<LI>
<P>You need to use cc_r, as <CODE>bigloo</CODE> uses threads
and on AIX cc_r links to the &quot;thread-safe&quot; libraries.
</P>
<LI>
<P>The GC distributed with <CODE>bigloo</CODE> won't configure
on AIX. You need to compile a separate GC of Hans Boehm and
supply the library to <CODE>bigloo</CODE>. Note you need to edit the
<CODE>configure</CODE> script for this. See the section on the GC.
</P>
<LI>
<P>In this README, <CODE>bigloo</CODE> is installed in &lt;$HOME/bigloo&gt;.
Libraries are installed in &lt;$HOME/local&gt;, some supporting binaries
are installed in <CODE>$HOME/bin</CODE>. You should alter these
paths if you want <CODE>bigloo</CODE> to reside elsewhere.
</P>
<LI>
<P>You need some extra scripts to get <CODE>bigloo</CODE> configured
and especially, to get a shared variant of <CODE>bigloo</CODE>. 
</P>
<LI>
<P>I use <CODE>$BIGLOODIR</CODE> as the directory where the sources
of <CODE>bigloo</CODE> reside.
</P>
<LI>
<P>This readme applies to a <CODE>bigloo</CODE> that was compiled using 
the VAC AIX cc_r compiler, version 5. It was compiled on an
IBM P660 with 2GB of memory and 2 PowerPC processors. The OS
version was AIX 4.3.3, patch level 9.
</P>
</UL>
</DIV>
<DIV class=toc><A NAME="Configuring_the_GC"></A><A HREF="#top"><H1>Configuring the GC</H1></A></DIV>
<DIV class=toc><A NAME="Compiling_Hans_Boehm_s_GC"></A><A HREF="#top"><H2>Compiling Hans Boehm's GC</H2></A></DIV>
<P>I used Hans Boehm's GC version 6.2 on AIX. I did following
to get it working:
</P>
<PRE> ./configure --prefix=$HOME/local CC=cc_r \
       CFLAGS=&quot;-qinfo=pro -qinfo=use -bdynamic -brtl&quot; \
       --cache-file=/dev/null --srcdir=.
 make
 make check
 make install
 cp -R include/private $HOME/local/include/gc
 cp .libs/libgc.exp $HOME/local/lib
</PRE>
<DIV class=toc><A NAME="Configuring_C_bigloo__with_the_external_GC"></A><A HREF="#top"><H2>Configuring <CODE>bigloo</CODE> with the external GC</H2></A></DIV>
<P>You need to alter the <CODE>configure</CODE> script of <CODE>bigloo</CODE> to configure
the external GC. I did it as follows:
</P>
<PRE> #*--- gc source directory (left blank for default configuration) ------*/
 customgc=no
 # the following two variables are relevant only when using 
 # standard (i.e. already existing and operational) Boehm's GC
 # and when customgc=no
 stdgclib=gc
 stdgcdir=$HOME/local/include/gc
</PRE>
<DIV class=toc><A NAME="Extra_scripts_to_get_C_bigloo__configured_compiled"></A><A HREF="#top"><H1>Extra scripts to get <CODE>bigloo</CODE> configured/compiled</H1></A></DIV>
<DIV class=toc><A NAME="A_wrapper_for_AIX_C_as"></A><A HREF="#top"><H2>A wrapper for AIX <CODE>as</CODE></H2></A></DIV>
<P>There are assemblers (like gnu as) that are able to C Pre Process
a file. Not so with the AIX as (after all, IBM products are never
easy).  It turns out that a preprocessing assembler can easily be
faked by the following script:
</P>
<PRE> #!/bin/sh

 INARGS=$*
 ASFILE=&quot;&quot;
 ARGS=&quot;&quot;

 for i in $INARGS
 do
         AS=`echo $i | grep -i &quot;\.s$&quot;`
         if [ &quot;$AS&quot; != &quot;&quot; ]; then
                 ASFILE=&quot;$AS&quot;
                 ARGS=&quot;$ARGS /tmp/tmp.s&quot;
         else
                 ARGS=&quot;$ARGS $i&quot;
         fi
 done

 cc -E $ASFILE | grep -v &quot;^#line&quot; &gt;/tmp/tmp.s
 as $ARGS
</PRE>
<P>I called the script <CODE>basm</CODE> (<CODE>bigloo</CODE> asm). <CODE>autoconf/ascpp</CODE> is
trying to run <CODE>$PWD/../bin/basm</CODE> in the 2.6c-alpha package.
</P>
<DIV class=toc><A NAME="A_wrapper_to_link_shared_libraries_on_AIX"></A><A HREF="#top"><H2>A wrapper to link shared libraries on AIX</H2></A></DIV>
<P>AIX needs special linking for shared objects and libraries. Normally,
the <CODE>&quot;-bnoentry -bexpall -bM:SRE&quot;</CODE> options would do, but bigloo uses
some functions and variables with leading underscores. These won't be
exported by using the <CODE>-bexpall</CODE> option. As suggested by Hans Oesterholt, 
an easy way to solve the problem is to use the folowing Perl script for linker:
</P>
<PRE> #!/usr/bin/perl

 my @ARGS=();

 while (my $arg=shift @ARGV) {
         push @ARGS,$arg;
         if ($arg eq &quot;-o&quot;) {
                 $shlib=shift @ARGV;
                 push @ARGS,$shlib;
         }
 }

 my $lib=$shlib;
 $lib=~s/\.so$/.a/;
 my $exp=$shlib;
 $exp=~s/\.so$/.exp/;

 if (-e $lib) {
         open IN,&quot;nm $lib |&quot;;
         open OUT,&quot;&gt;$exp&quot;;
         while (&lt;IN&gt;) {
                 my $name=isexp($_);
                 if ($name ne &quot;&quot;) {
                         print OUT &quot;$name\n&quot;;
                 }
         }
         close OUT;
         close IN;
         $linkopt=&quot;-bE:$exp&quot;;
 }
 else {
         $linkopt=&quot;-bexpall&quot;;
         print &quot;WARNING(aixld.pl)! No $lib exists, note: -bexpall does not export symbols with leading '_'\n&quot;;
 }

 system(&quot;cc_r&quot;,@ARGS,$linkopt);

 sub isexp {
         my $line=shift;
         my ($name,$type,$rest)=split /\s+/,$line;

         $name=&quot;&quot;, if ($type eq &quot;u&quot;);
         $name=&quot;&quot;, if ($type eq &quot;U&quot;);
         $name=&quot;&quot;, if ($type eq &quot;d&quot;);   
         $name=&quot;&quot;, if ($type eq &quot;f&quot;);
         $name=&quot;&quot;, if ($type eq &quot;t&quot;);
         $name=&quot;&quot;, if ($type eq &quot;T&quot;);
         $name=&quot;&quot;, if ($type eq &quot;b&quot;);
         $name=&quot;&quot;, if ($type eq &quot;a&quot;);
         $name=&quot;&quot;, if ($type eq &quot;&quot;);
 return $name;
 }
</PRE>
<P>Though not efficient, it is sufficient. This script hopes to find a static library
at the place, the shared libraries is being made. The static library notably has all 
symbols in it.  This script does an <CODE>nm</CODE> on the static library (which should already 
exist) and then exports all global text/data symbols in it.  I called the script 
<CODE>aixshld.pl</CODE> and put it in <CODE>$HOME/bin</CODE>. NB. It will utterly fail when making a
shared object/library with symbols with leading underscores in it, if no static 
library (archive) of it exists. So this script does fit in the making process of <CODE>bigloo</CODE>
but cannot be used for general shared linking. 
</P>
<P>It could be an idea to enhance the script to examine all object files supplied to
the linker, instead of an assumed static library.
</P>
<DIV class=toc><A NAME="configuring_C_bigloo"></A><A HREF="#top"><H1>configuring <CODE>bigloo</CODE></H1></A></DIV>
<P>With the <CODE>basm</CODE> script in <CODE>$BIGLOODIR/../bin</CODE>, and <CODE>aixshld.pl</CODE> in <CODE>$HOME/bin</CODE>
<CODE>bigloo</CODE> could be configured as follows:
</P>
<PRE> ./configure --prefix=$HOME/C&lt;bigloo&gt; --native=yes --jvm=no --dotnet=no --customgc=no \
        --cc=cc_r --ld=&quot;$HOME/bin/aixshld.pl -L$HOME/local/lib -lgc&quot; \
        --cflags=&quot;-qcpluscmt -I$HOME/local/include -L$HOME/local/lib&quot; \
        --coflags=&quot;-qmaxmem=16384 -O -I$HOME/local/include -L$HOME/local/lib&quot; \
        --sharedbde=yes --as=$PWD/tools/basm
</PRE>
<P>Please note the <CODE>-qcpluscmt</CODE> option. Some files use C++ '//' comments. Of course
the IBM cc compiler won't accept '//' by default. Also note the <CODE>-qmaxmem=16384</CODE>
option. The cc optimizer uses a maximum of 2048KB memory per default. This won't
be enough for the optimizer.
</P>
<DIV class=toc><A NAME="Building_C_bigloo"></A><A HREF="#top"><H1>Building <CODE>bigloo</CODE></H1></A></DIV>
<P>I didn't try any other options. The <CODE>bigloo</CODE> debugger will probably not work, as AIX
works with the <CODE>dbx</CODE> debugger, not <CODE>gdb</CODE>. I didn't try bee.
</P>
<DIV class=toc><A NAME="Making_it"></A><A HREF="#top"><H2>Making it</H2></A></DIV>
<P>To make <CODE>bigloo</CODE>, after configuring it, just type:
</P>
<PRE> make
 make test
 make install
</PRE>
<DIV class=toc><A NAME="Testresults"></A><A HREF="#top"><H2>Testresults</H2></A></DIV>
<P>On my AIX machine, only one test failed: the process(kill) test.  I had to
comment out the process(kill) test. After that all tests passed. I don't know what
is the problem with process(kill). Somehow the killed process stays in the process
table? I never experienced problems with kill on AIX using C or Perl.
</P>
<DIV class=toc><A NAME="Authors"></A><A HREF="#top"><H1>Authors</H1></A></DIV>
<P>Manuel Serrano &lt;Manuel.Serrano@sophia.inria.fr&gt;, Hans Oesterholt-Dijkema &lt;hdnews@gawab.com&gt;
</P>
<br><p><CENTER><SMALL><I>generated by spod:to-html 1.8</CENTER></SMALL></I></DIV>
</BODY></HTML>

