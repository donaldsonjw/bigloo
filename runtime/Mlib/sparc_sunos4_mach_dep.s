!*=====================================================================*/
!*    serrano/prgm/project/bigloo/runtime1.8/Mlib/sparc_mach_dep.s     */
!*    -------------------------------------------------------------    */
!*    Author      :  Manuel Serrano                                    */
!*    Creation    :  Tue Aug  8 08:50:08 1995                          */
!*    Last change :                                                    */
!*    -------------------------------------------------------------    */
!*    A Sparc specific file (it implements __setjmp/__longjmp and      */
!*    flush_regs_in_stack).                                            */
!*=====================================================================*/

	.seg 	"text"
!*---------------------------------------------------------------------*/
!*    flush_regs_in_stack ...                                          */
!*---------------------------------------------------------------------*/
	.globl	_flush_regs_in_stack
_flush_regs_in_stack:
	ta	0x3   ! ST_FLUSH_WINDOWS
	mov	%sp,%o0
	retl
	nop

!*---------------------------------------------------------------------*/
!*    __setjmp                                                         */
!*---------------------------------------------------------------------*/
	.globl  ___setjmp
___setjmp:
	st      %sp,[%o0]
	st      %o7,[%o0+4]
	retl
	clr     %o0

!*---------------------------------------------------------------------*/
!*    __longjmp                                                        */
!*---------------------------------------------------------------------*/
	.globl  ___longjmp
___longjmp:
	ld      [%o0],%g1
	ld      [%o0+4],%g2
	mov     %o1,%g3
2:	cmp     %fp,%g1
	bleu,a  2b
	restore
	jmp     %g2+8
	mov     %g3,%o0

